@inherits FlowbiteComponentBase

<!-- Header (begin) -->
<header class="z-40 w-full mx-auto bg-white border-b border-gray-200 dark:border-gray-700 dark:bg-gray-800">
    <div class="px-2 py-2.5 flex flex-wrap justify-between items-center">

        <!-- Left-Side Component Group -->
        <div class="flex justify-start items-center">

            @if (ResponsiveMenuEnabled && ShowSidebarToggle)
            {
                <button id="responsive-menu-toggle"
                    @onclick="OnResponsiveMenuToggle"
                    class="p-2 text-gray-600 rounded-lg cursor-pointer lg:hidden hover:text-gray-900 hover:bg-gray-100 focus:bg-gray-100 dark:focus:bg-gray-700 focus:ring-2 focus:ring-gray-100 dark:focus:ring-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    
                    @* Hamburger Icon *@
                    <svg id="hamburger-icon" aria-hidden="true" class="w-6 h-6 @(IsOpen ? "hidden" : "")" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                            clip-rule="evenodd"></path>
                    </svg>

                    @* Close Icon *@
                    <svg id="close-icon" aria-hidden="true" class="w-6 h-6 @(IsOpen ? "" : "hidden")" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                            clip-rule="evenodd"></path>
                    </svg>
                    <span class="sr-only">Toggle sidebar</span>
                </button>
            }

            <NavbarBrand Href="/">
                <img src="/favicon.png" class="mr-3 h-6 sm:h-9" alt="Riddle Logo" />
                <span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Riddle</span>
            </NavbarBrand>
            
        </div>

        <!-- Right-Side Component Group -->
        <div class="flex items-center gap-2">
            <DarkMode />
            
            <AuthorizeView>
                <Authorized>
                    @{
                        var pictureUrl = context.User.FindFirst("picture")?.Value;
                        var userName = context.User.Identity?.Name ?? "User";
                        var userEmail = context.User.FindFirst("email")?.Value ?? context.User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value;
                    }
                    <div class="relative">
                        <button type="button" @onclick="ToggleUserMenu" @onclick:stopPropagation="true"
                            class="flex items-center gap-2 p-1.5 text-sm text-gray-700 rounded-lg hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">
                            @if (!string.IsNullOrEmpty(pictureUrl))
                            {
                                <img src="@pictureUrl" alt="@userName" class="h-8 w-8 rounded-full object-cover" referrerpolicy="no-referrer" />
                            }
                            else
                            {
                                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-300">
                                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            }
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        
                        @if (_userMenuOpen)
                        {
                            <div class="absolute right-0 z-50 mt-2 w-56 rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-600 dark:bg-gray-700">
                                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-600">
                                    <span class="block text-sm font-medium text-gray-900 dark:text-white">@userName</span>
                                    @if (!string.IsNullOrEmpty(userEmail))
                                    {
                                        <span class="block text-sm text-gray-500 truncate dark:text-gray-400">@userEmail</span>
                                    }
                                </div>
                                <ul class="py-1">
                                    <li>
                                        <a href="/Account/Manage" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600">
                                            <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            </svg>
                                            Settings
                                        </a>
                                    </li>
                                </ul>
                                <div class="border-t border-gray-200 dark:border-gray-600">
                                    <a href="/Account/Logout" class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:text-red-400 dark:hover:bg-gray-600">
                                        <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Sign out
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                </Authorized>
                <NotAuthorized>
                    <Button Href="/Account/Login" Color="ButtonColor.Primary" Size="ButtonSize.Small">
                        Sign in
                    </Button>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </div>
</header>

@code 
{
    [Inject] 
    private NavigationManager Navigation { get; set; } = default!;

    /// <summary>
    /// Boolean parameter to determine if the header shows the collapsible menu
    /// </summary>
    [Parameter]
    public bool ResponsiveMenuEnabled { get; set; } = true;

    /// <summary>
    /// Event callback that fires when the responsive menu toggle button is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnResponsiveMenuToggle { get; set; }

    /// <summary>
    /// Boolean parameter to determine if the responsive menu is open
    /// </summary>
    [Parameter]
    public bool IsOpen { get; set; }

    /// <summary>
    /// Boolean parameter to control visibility of the sidebar toggle button.
    /// Set to false for layouts without a sidebar (e.g., StackedLayout).
    /// </summary>
    [Parameter]
    public bool ShowSidebarToggle { get; set; } = true;

    private bool _userMenuOpen = false;

    private void ToggleUserMenu()
    {
        _userMenuOpen = !_userMenuOpen;
    }

    private void HandleLogout()
    {
        Navigation.NavigateTo("/Account/Logout", forceLoad: true);
    }
}
